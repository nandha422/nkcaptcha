<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NK CAPTCHA</title>
<style>
/* Reset */
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:"Inter",system-ui,Arial,sans-serif;
  background:linear-gradient(135deg,#0f172a,#1e293b);
  color:#f1f5f9;min-height:100vh;
  display:flex;flex-direction:column;align-items:center;
  padding:20px;
}
.container{
  width:100%;max-width:420px;
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(12px);
  padding:28px;border-radius:16px;
  box-shadow:0 8px 28px rgba(0,0,0,0.6);
}
h1,h2{text-align:center;margin-bottom:18px;color:#38bdf8;font-weight:600;}
form{display:flex;flex-direction:column;gap:14px;}
input{padding:12px;border-radius:8px;border:none;outline:none;
  font-size:14px;background:rgba(255,255,255,0.1);color:#f1f5f9;}
input:focus{background:rgba(255,255,255,0.2);border:1px solid #38bdf8;}
button{padding:12px;border:none;border-radius:8px;background:#3b82f6;
  color:white;font-weight:600;cursor:pointer;}
button:hover{background:#2563eb;transform:translateY(-2px);}
.captcha-box{margin:18px 0;display:flex;justify-content:space-between;
  align-items:center;background:rgba(255,255,255,0.08);padding:10px;
  border-radius:8px;}
.captcha-code{font-size:20px;font-weight:bold;letter-spacing:3px;color:#facc15;}
#progress-container{width:100%;height:10px;background:rgba(255,255,255,0.2);
  border-radius:5px;overflow:hidden;margin-top:12px;}
#progress-bar{height:100%;width:0%;background:#22c55e;transition:width 1s linear;}
#ad-placeholder{margin-top:12px;padding:10px;text-align:center;display:none;
  background:#111827;border-radius:6px;}
</style>
</head>
<body>
<div class="container">
  <h1>NK CAPTCHA</h1>

  <!-- Signup -->
  <div id="signup-section" style="display:none;">
    <h2>Sign Up</h2>
    <form id="signup-form">
      <input type="email" id="signup-email" placeholder="Email" required>
      <input type="password" id="signup-password" placeholder="Password" required>
      <label><input type="checkbox" id="terms-checkbox"> I agree to Terms</label>
      <button type="submit">Sign Up</button>
    </form>
    <p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
  </div>

  <!-- Login -->
  <div id="login-section" style="display:none;">
    <h2>Login</h2>
    <form id="login-form">
      <input type="email" id="login-email" placeholder="Email" required>
      <input type="password" id="login-password" placeholder="Password" required>
      <button type="submit">Login</button>
    </form>
    <p>Don't have an account? <a href="#" onclick="showSignup()">Sign Up</a></p>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" style="display:none;">
    <h2>Dashboard</h2>
    <p>Points: <span id="points">0</span></p>

    <div class="captcha-box">
      <span class="captcha-code" id="captcha-text"></span>
      <button onclick="generateCaptcha()">↻</button>
    </div>

    <input type="text" id="captcha-input" placeholder="Enter Captcha">
    <button id="verify-btn">Submit</button>
    <button onclick="logout()">Logout</button>

    <div id="progress-container">
      <div id="progress-bar"></div>
    </div>
    <p id="time-left"></p>

    <!-- Ad box -->
    <div id="ad-placeholder"></div>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<script>
// ================= FIREBASE INIT =================
const firebaseConfig = {
  apiKey: "AIzaSyBjkSg5mcAdcNLtNXVEt3OWBnyJYc0kSM4",
  authDomain: "captcha-e2954.firebaseapp.com",
  projectId: "captcha-e2954",
  storageBucket: "captcha-e2954.appspot.com",
  messagingSenderId: "564130348715",
  appId: "1:564130348715:web:f36424d02592a94406c1ee"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null, points = 0, timerInterval, currentCaptcha = "";
let totalTime = 15; // seconds

// ================= UI FUNCTIONS =================
function showLogin(){document.getElementById("signup-section").style.display="none";document.getElementById("login-section").style.display="block";}
function showSignup(){document.getElementById("login-section").style.display="none";document.getElementById("signup-section").style.display="block";}
function showDashboard(){document.getElementById("signup-section").style.display="none";document.getElementById("login-section").style.display="none";document.getElementById("dashboard").style.display="block";generateCaptcha();}

// ================= AUTH =================
document.getElementById("signup-form").addEventListener("submit",e=>{
  e.preventDefault();
  const email=document.getElementById("signup-email").value;
  const password=document.getElementById("signup-password").value;
  if(!document.getElementById("terms-checkbox").checked){alert("Agree to Terms");return;}
  auth.createUserWithEmailAndPassword(email,password).then(userCred=>{
    currentUser=userCred.user;points=0;
    return db.collection("users").doc(currentUser.uid).set({email,points:0,captchaCount:0,lastActivity:firebase.firestore.FieldValue.serverTimestamp()});
  }).then(()=>{document.getElementById("points").innerText=points.toFixed(4);showDashboard();}).catch(err=>alert(err.message));
});

document.getElementById("login-form").addEventListener("submit",e=>{
  e.preventDefault();
  const email=document.getElementById("login-email").value;
  const password=document.getElementById("login-password").value;
  auth.signInWithEmailAndPassword(email,password).then(userCred=>{
    currentUser=userCred.user;
    return db.collection("users").doc(currentUser.uid).get();
  }).then(doc=>{
    points=doc.exists?doc.data().points:0;
    document.getElementById("points").innerText=points.toFixed(4);
    showDashboard();
  }).catch(err=>alert(err.message));
});

function logout(){
  auth.signOut();currentUser=null;points=0;
  clearInterval(timerInterval);
  document.getElementById("dashboard").style.display="none";
  showLogin();
}

// ================= CAPTCHA =================
const captchaText=document.getElementById("captcha-text");
const captchaInput=document.getElementById("captcha-input");
const pointsDisplay=document.getElementById("points");
const progressBar=document.getElementById("progress-bar");
const timeLeftDisplay=document.getElementById("time-left");
const adBox=document.getElementById("ad-placeholder");

function generateCaptcha(){
  const chars="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
  currentCaptcha="";for(let i=0;i<5;i++){currentCaptcha+=chars.charAt(Math.floor(Math.random()*chars.length));}
  captchaText.textContent=currentCaptcha;
  captchaInput.value="";captchaInput.disabled=false;adBox.style.display="none";
  startCaptchaTimer();
}

function startCaptchaTimer(){
  clearInterval(timerInterval);let timeLeft=totalTime;
  progressBar.style.width="0%";timeLeftDisplay.textContent=`${timeLeft}s`;
  timerInterval=setInterval(()=>{
    timeLeft--;let progress=((totalTime-timeLeft)/totalTime)*100;
    progressBar.style.width=progress+"%";timeLeftDisplay.textContent=`${timeLeft}s`;
    if(timeLeft<=0){clearInterval(timerInterval);alert("⏰ Time’s up!");generateCaptcha();}
  },1000);
}

// ================= VERIFY =================
document.getElementById("verify-btn").addEventListener("click",async()=>{
  const input=captchaInput.value.trim().toUpperCase();
  if(input===currentCaptcha){
    points+=0.0001;pointsDisplay.textContent=points.toFixed(4);
    if(currentUser){
      const userRef=db.collection("users").doc(currentUser.uid);
      await userRef.set({email:currentUser.email,lastActivity:firebase.firestore.FieldValue.serverTimestamp()},{merge:true});
      await userRef.update({points:firebase.firestore.FieldValue.increment(0.0001),captchaCount:firebase.firestore.FieldValue.increment(1)});
    }
    // SHOW AD SCRIPT HERE
    adBox.style.display="block";
    adBox.innerHTML = `<script>(function(d,a,b){let s=d.createElement('script');s.async=true;s.src='https://peacyx.com/code/pops.js?h=waWQiOjExNjcwNDIsInNpZCI6MTU1OTgzMiwid2lkIjo3MjMyODAsInNyYyI6Mn0=eyJ&si1='+a+'&si2='+b;d.head.appendChild(s);})(document,'subid1','subid2');<\/script>`;
    alert("✅ Correct! +0.0001 earned.");
    generateCaptcha();
  }else{
    alert("❌ Wrong captcha. Try again!");
  }
});
</script>
</body>
</html>